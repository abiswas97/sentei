#!/usr/bin/env bash
set -euo pipefail

commit_msg_file="$1"
commit_msg=$(head -1 "$commit_msg_file")

if echo "$commit_msg" | grep -qE '^Merge '; then
  exit 0
fi

if ! echo "$commit_msg" | grep -qE '^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\(.+\))?!?: .+'; then
  echo "ERROR: Commit message does not follow conventional commit format."
  echo ""
  echo "Expected: <type>[optional scope][optional !]: <description>"
  echo "Types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert"
  echo ""
  echo "Examples:"
  echo "  feat: add new feature"
  echo "  fix(parser): handle empty input"
  echo "  feat!: change CLI args"
  exit 1
fi
